// Modern Onboarding Component SCSS

// Variables
:root {
  --primary-color: #4f46e5; // Modern indigo
  --primary-dark: #4338ca; // Darker indigo for gradients
  --primary-rgb: 79, 70, 229; // RGB values for primary color
  --primary-light: rgba(79, 70, 229, 0.1);
  --primary-hover: rgba(79, 70, 229, 0.15);
  --success-color: #10b981; // Modern green
  --success-rgb: 16, 185, 129; // RGB values for success color
  --error-color: #ef4444; // Modern red
  --error-rgb: 239, 68, 68; // RGB values for error color
  --text-primary: #111827; // Near black
  --text-secondary: #6b7280; // Gray
  --border-color: rgba(0, 0, 0, 0.08);
  --card-bg: #ffffff;
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 12px 35px rgba(0, 0, 0, 0.15);
  --border-radius: 20px; // More rounded corners
  --transition-speed: 0.3s;
}

// Dark mode variables
.dark-theme {
  --primary-color: #818cf8; // Lighter indigo for dark mode
  --primary-dark: #6366f1; // Darker indigo for gradients in dark mode
  --primary-rgb: 129, 140, 248; // RGB values for primary color in dark mode
  --primary-light: rgba(129, 140, 248, 0.15);
  --primary-hover: rgba(129, 140, 248, 0.25);
  --success-color: #34d399; // Lighter green for dark mode
  --success-rgb: 52, 211, 153; // RGB values for success color in dark mode
  --error-color: #f87171; // Lighter red for dark mode
  --error-rgb: 248, 113, 113; // RGB values for error color in dark mode
  --text-primary: #f9fafb; // Near white
  --text-secondary: #d1d5db; // Light gray
  --border-color: rgba(255, 255, 255, 0.1);
  --card-bg: #1f2937; // Dark background
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.25);
  --shadow-lg: 0 12px 35px rgba(0, 0, 0, 0.3);
}

// Main container
.onboarding-stepper-container {
  /* Map component variables to global theme tokens */
  --text-primary: var(--sf-text);
  --text-secondary: var(--sf-muted);
  --card-bg: var(--sf-card);
  --primary-color: var(--sf-primary);

  height: 100%;
  width: 100%;
  margin: 0 auto;
  display: block;
  position: relative;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  overflow-y: auto;
  overflow-x: hidden;
  
  .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 10;
    background: transparent;
    border: none;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-speed) ease;
    
    &:hover {
      background-color: var(--sf-glass-bg);
      transform: rotate(90deg);
      
      .dark-theme & {
        background-color: rgba(255, 255, 255, 0.1);
      }

// Global mat-select overlay fix
::ng-deep .cdk-overlay-container {
  z-index: 10000 !important;
}

::ng-deep .cdk-overlay-pane {
  z-index: 10000 !important;
}

::ng-deep .mat-mdc-select-panel {
  z-index: 10001 !important;
  position: fixed !important;
}

// Fix for dropdown positioning issues
::ng-deep .cdk-overlay-connected-position-bounding-box {
  z-index: 10000 !important;
}

::ng-deep .mat-mdc-select-panel-wrap {
  z-index: 10001 !important;
}

// Custom Input Design (from Uiverse.io by alexruix)
.input-group {
  position: relative;
}

.input {
  border: solid 1.5px #9e9e9e;
  border-radius: 1rem;
  background: none;
  padding: 1rem;
  font-size: 1rem;
  color: var(--text-primary);
  transition: border 150ms cubic-bezier(0.4,0,0.2,1);
  width: 100%;
}

.user-label {
  position: absolute;
  left: 15px;
  color: var(--text-secondary);
  pointer-events: none;
  transform: translateY(1rem);
  transition: 150ms cubic-bezier(0.4,0,0.2,1);
  background: var(--card-bg);
  padding: 0 0.2em;
}

.input:focus, .input:valid {
  outline: none;
  border: 1.5px solid var(--primary-color);
}

.input:focus ~ .user-label, .input:valid ~ .user-label {
  transform: translateY(-50%) scale(0.8);
  background-color: var(--card-bg);
  padding: 0 .2em;
  color: var(--primary-color);
}

  // Animations
  @keyframes float {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes shimmer {
    0% {
      left: -100%;
    }
    100% {
      left: 100%;
    }
  }

  @keyframes progressRing {
    from {
      stroke-dashoffset: 157;
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  @keyframes pulse {
    0% {
      transform: scale(1);
      opacity: 0.6;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.3;
    }
    100% {
      transform: scale(1);
      opacity: 0.6;
    }
  }

  // Responsive Design
  @media (max-width: 768px) {
    .get-started-view {
      .hero-section {
        flex-direction: column;
        text-align: center;
        padding: 40px 20px;
        
        .hero-content {
          max-width: 100%;
          margin-bottom: 40px;
          
          .hero-stats {
            justify-content: center;
          }
        }
        
        .hero-illustration {
          flex: 0 0 250px;
          height: 250px;
        }
      }
      
      .steps-preview-section {
        padding: 40px 20px;
        
        .steps-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }
      }
      
      .cta-section {
        padding: 30px 20px 40px;
        
        .get-started-button {
          padding: 16px 32px;
          font-size: 1rem;
        }
      }
    }

    // Mobile Stepper Layout
    .onboarding-panels {
      flex-direction: column;
      
      .left-panel {
        width: 100%;
        max-height: 200px;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        
        .progress-header {
          padding: 20px 16px 16px;
          
          .progress-info {
            margin-bottom: 12px;
            
            .progress-title {
              font-size: 1.2rem;
            }
          }
          
          .progress-circle {
            .progress-ring {
              width: 50px;
              height: 50px;
            }
            
            .progress-percentage {
              font-size: 0.8rem;
            }
          }
        }
        
        .stepper-nav {
          display: none; // Hide detailed stepper on mobile
        }
        
        .nav-footer {
          display: none; // Hide footer on mobile
        }
      }
      
      .right-panel {
        padding: 20px 16px 80px;
      }
    }
  }

  @media (max-width: 480px) {
    .get-started-view {
      .hero-section {
        .hero-content {
          .hero-title {
            font-size: 2.5rem;
          }
          
          .hero-description {
            font-size: 1.1rem;
          }
          
          .hero-stats {
            flex-direction: column;
            gap: 16px;
            
            .stat-divider {
              display: none;
            }
          }
        }
      }
    }
  }
    }
    
    mat-icon {
      font-size: 24px;
      color: var(--text-secondary);
    }
  }
  
  .onboarding-card {
    width: 100%;
    height: 95vh;
    max-height: 95vh;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background-color: var(--card-bg);
    position: relative;
    backdrop-filter: blur(10px);
  }
  
  .onboarding-header {
    display: none; // remove header space as requested
  }

  // Get Started View (Initial State)
  .get-started-view {
    padding: 16px;
    max-width: none;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    justify-content: space-between;
    align-items: center;
    text-align: center;
    
    // Hero Section
    .hero-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px 16px;
      background: linear-gradient(135deg, 
        rgba(var(--primary-rgb), 0.05) 0%, 
        rgba(var(--primary-rgb), 0.02) 50%, 
        transparent 100%);
      position: relative;
      overflow: hidden;
      flex: 0 0 auto;
      width: 100%;
      max-width: 600px;
      
      &::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(var(--primary-rgb), 0.1) 0%, transparent 70%);
        pointer-events: none;
      }
      
      .hero-content {
        width: 100%;
        z-index: 2;
        text-align: center;
        
        .hero-badge {
          display: inline-flex;
          align-items: center;
          gap: 8px;
          padding: 8px 16px;
          background: rgba(var(--primary-rgb), 0.1);
          border: 1px solid rgba(var(--primary-rgb), 0.2);
          border-radius: 50px;
          color: var(--primary-color);
          font-size: 0.9rem;
          font-weight: 500;
          margin-bottom: 24px;
          backdrop-filter: blur(10px);
          
          mat-icon {
            font-size: 18px;
            width: 18px;
            height: 18px;
          }
        }
        
        .hero-title {
          font-size: clamp(1.2rem, 2vw, 1.6rem);
          font-weight: 800;
          color: var(--text-primary);
          margin-bottom: 8px;
          line-height: 1.2;
          
          .gradient-text {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
          }
          
          &.main-title {
            font-size: 3.5rem;
            text-align: center;
            margin-bottom: 30px;
          }
        }
        
        .hero-description {
          font-size: 0.85rem;
          color: var(--text-secondary);
          margin-bottom: 12px;
          line-height: 1.4;
          max-width: 500px;
          margin-left: auto;
          margin-right: auto;
        }
        
        .hero-stats {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 20px;
          
          .stat-item {
            text-align: center;
            
            .stat-number {
              font-size: 1.5rem;
              font-weight: 700;
              color: var(--primary-color);
              line-height: 1;
            }
            
            .stat-label {
              font-size: 0.9rem;
              color: var(--text-secondary);
              margin-top: 4px;
            }
          }
          
          .stat-divider {
            width: 1px;
            height: 40px;
            background: var(--border-color);
          }
        }
      }
      
      .hero-illustration {
        display: none; // Hide illustration to save space and improve alignment
        
        .floating-cards {
          position: relative;
          width: 100%;
          height: 100%;
          
          .card-item {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: float 6s ease-in-out infinite;
            
            .dark-theme & {
              background: rgba(var(--card-bg), 0.9);
              border-color: rgba(255, 255, 255, 0.1);
            }
            
            mat-icon {
              font-size: 32px;
              width: 32px;
              height: 32px;
              color: var(--primary-color);
            }
            
            span {
              font-size: 0.9rem;
              font-weight: 600;
              color: var(--text-primary);
            }
            
            &.card-1 {
              top: 20%;
              left: 10%;
              animation-delay: 0s;
            }
            
            &.card-2 {
              top: 50%;
              right: 20%;
              animation-delay: 2s;
            }
            
            &.card-3 {
              bottom: 20%;
              left: 30%;
              animation-delay: 4s;
            }
          }
        }
      }
    }
    
    // Steps Preview Section
    .steps-preview-section {
      padding: 12px 16px;
      flex: 1;
      overflow: visible;
      min-height: 0;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      
      .preview-title {
        text-align: center;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 16px;
      }
      
      .steps-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 12px;
        max-width: 100%;
        margin: 0 auto;
        justify-items: center;
        height: auto;
        
        .step-preview-card {
          display: flex;
          align-items: flex-start;
          gap: 10px;
          padding: 12px;
          background: var(--card-bg);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          transition: all 0.3s ease;
          animation: slideInUp 0.6s ease-out both;
          width: 100%;
          min-height: 80px;
          max-height: 90px;
          
          &:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
            border-color: rgba(var(--primary-rgb), 0.3);
          }
          
          .step-preview-icon {
            position: relative;
            flex-shrink: 0;
            
            .step-number {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              font-size: 1.2rem;
              font-weight: 700;
              color: var(--primary-color);
              z-index: 2;
            }
            
            .step-progress-ring {
              .progress-ring {
                transform: rotate(-90deg);
                
                .progress-ring-circle {
                  fill: none;
                  stroke: rgba(var(--primary-rgb), 0.2);
                  stroke-width: 3;
                  stroke-linecap: round;
                  stroke-dasharray: 157;
                  stroke-dashoffset: 0;
                  animation: progressRing 2s ease-out;
                }
              }
            }
          }
          
          .step-preview-content {
            flex: 1;
            
            .step-title {
              font-size: 0.8rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 4px;
              line-height: 1.1;
            }
            
            .step-description {
              font-size: 0.7rem;
              color: var(--text-secondary);
              line-height: 1.2;
              margin: 0;
              display: -webkit-box;
              -webkit-line-clamp: 2;
              -webkit-box-orient: vertical;
              overflow: hidden;
            }
          }
        }
      }
    }
    
    // CTA Section
    .cta-section {
      text-align: center;
      padding: 16px 20px;
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      
      .cta-buttons {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        width: 100%;
      }
      
      .get-started-button {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 16px rgba(var(--primary-rgb), 0.3);
        overflow: hidden;
        z-index: 10;
        min-width: 180px;
        
        &:hover {
          transform: translateY(-2px);
          box-shadow: 0 12px 40px rgba(var(--primary-rgb), 0.4);
          
          .button-glow {
            opacity: 1;
          }
        }
        
        &:active {
          transform: translateY(0);
        }
        
        mat-icon {
          font-size: 20px;
          width: 20px;
          height: 20px;
        }
        
        .button-glow {
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
          opacity: 0;
          transition: all 0.6s ease;
          animation: shimmer 2s infinite;
        }
      }
      
      .skip-button {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        padding: 10px 20px;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 140px;
        
        &:hover {
          background: var(--card-bg);
          color: var(--text-primary);
          border-color: var(--primary-color);
          transform: translateY(-1px);
        }
        
        &:active {
          transform: translateY(0);
        }
      }
      
      .privacy-footer {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        font-size: 0.8rem;
        color: var(--text-secondary);
        background: rgba(var(--card-bg), 0.95);
        padding: 8px 16px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-color);
        z-index: 1000;
        
        mat-icon {
          font-size: 16px;
          width: 16px;
          height: 16px;
          color: var(--success-color);
        }
      }
    }
  }

  // Two-panel layout (after Get Started)
  .onboarding-panels {
    display: flex;
    height: 100%; // fill full modal height now that header is removed
    overflow: hidden; /* Prevent content overflow */

    // Left panel (stepper)
    .left-panel {
      width: 280px;
      height: 100%;
      border-right: 1px solid var(--border-color);
      padding: 0;
      overflow-y: auto;
      overflow-x: hidden;
      background: linear-gradient(135deg, 
        rgba(var(--primary-rgb), 0.02) 0%, 
        rgba(var(--card-bg), 0.95) 20%, 
        var(--card-bg) 100%);
      backdrop-filter: blur(20px);
      display: flex;
      flex-direction: column;

      // Progress Header
      .progress-header {
        padding: 20px 16px 16px;
        border-bottom: 1px solid rgba(var(--border-color), 0.5);
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        
        .progress-info {
          margin-bottom: 12px;
          
          .progress-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 4px 0;
          }
          
          .progress-stats {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            
            .current-step {
              color: var(--primary-color);
              font-weight: 600;
            }
            
            .total-steps {
              color: var(--text-secondary);
            }
          }
        }
        
        .progress-circle {
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
          
          .progress-ring {
            width: 50px;
            height: 50px;
            transform: rotate(-90deg);
            
            .progress-ring-fill {
              transition: stroke-dashoffset 0.6s ease;
              stroke-linecap: round;
            }
          }
          
          .progress-percentage {
            position: absolute;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--primary-color);
          }
        }
      }

      // Stepper Navigation
      .stepper-nav {
        flex: 1;
        padding: 16px 12px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        overflow-y: auto;
        overflow-x: hidden;

        .step-item {
          position: relative;
          display: flex;
          align-items: flex-start;
          padding: 12px 10px;
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.3s ease;
          border: 1px solid transparent;
          background: transparent;

          &:hover {
            background: rgba(var(--primary-rgb), 0.04);
            transform: translateX(4px);
          }

          &.active {
            background: linear-gradient(135deg, 
              rgba(var(--primary-rgb), 0.1) 0%, 
              rgba(var(--primary-rgb), 0.05) 100%);
            border-color: rgba(var(--primary-rgb), 0.2);
            box-shadow: 0 4px 20px rgba(var(--primary-rgb), 0.15);
            
            .step-icon .step-number {
              background: var(--primary-color);
              color: white;
              box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
            }
          }

          &.completed {
            .step-icon .completed-icon {
              color: var(--success-color);
            }
            
            .step-content .step-title {
              color: var(--success-color);
            }
          }

          &.upcoming {
            opacity: 0.6;
            
            .step-icon .step-number {
              background: var(--border-color);
              color: var(--text-secondary);
            }
          }

          // Step Connector Line
          .step-connector {
            position: absolute;
            top: -8px;
            left: 35px;
            width: 2px;
            height: 16px;
            background: var(--border-color);
            transition: background-color 0.3s ease;
            
            &.completed {
              background: var(--success-color);
            }
          }

          // Step Icon
          .step-icon {
            position: relative;
            flex-shrink: 0;
            margin-right: 12px;
            z-index: 2;

            .step-number {
              width: 28px;
              height: 28px;
              border-radius: 50%;
              background: var(--card-bg);
              border: 2px solid var(--border-color);
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 700;
              font-size: 0.75rem;
              color: var(--text-primary);
              transition: all 0.3s ease;
              position: relative;
              
              &.active {
                .pulse-ring {
                  position: absolute;
                  top: -4px;
                  left: -4px;
                  right: -4px;
                  bottom: -4px;
                  border: 2px solid var(--primary-color);
                  border-radius: 50%;
                  animation: pulse 2s infinite;
                  opacity: 0.6;
                }
              }
            }

            .completed-icon {
              font-size: 28px;
              width: 28px;
              height: 28px;
            }
          }

          // Step Content
          .step-content {
            flex: 1;
            min-width: 0;

            .step-title {
              font-size: 0.85rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 2px;
              line-height: 1.2;
            }

            .step-description {
              font-size: 0.75rem;
              color: var(--text-secondary);
              line-height: 1.3;
              margin-bottom: 4px;
              display: -webkit-box;
              -webkit-line-clamp: 1;
              -webkit-box-orient: vertical;
              overflow: hidden;
            }

            .step-status {
              display: flex;
              align-items: center;
              gap: 3px;
              font-size: 0.7rem;
              font-weight: 500;

              mat-icon {
                font-size: 12px;
                width: 12px;
                height: 12px;
              }

              .status-completed {
                color: var(--success-color);
              }

              .status-current {
                color: var(--primary-color);
              }

              .status-upcoming {
                color: var(--text-secondary);
              }
            }
          }

          // Step Actions
          .step-actions-mini {
            opacity: 0;
            transition: opacity 0.3s ease;

            .edit-step {
              width: 32px;
              height: 32px;
              
              mat-icon {
                font-size: 16px;
                width: 16px;
                height: 16px;
              }
            }
          }

          &:hover .step-actions-mini {
            opacity: 1;
          }
        }
      }

      // Navigation Footer
      .nav-footer {
        padding: 12px 16px 20px;
        border-top: 1px solid rgba(var(--border-color), 0.5);
        background: rgba(255, 255, 255, 0.02);
        
        .estimated-time {
          display: flex;
          align-items: center;
          gap: 6px;
          font-size: 0.75rem;
          color: var(--text-secondary);
          margin-bottom: 10px;
          
          mat-icon {
            font-size: 14px;
            width: 14px;
            height: 14px;
            color: var(--primary-color);
          }
        }
        
        .help-section {
          .help-button {
            width: 100%;
            justify-content: flex-start;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(var(--primary-rgb), 0.05);
            color: var(--primary-color);
            border: 1px solid rgba(var(--primary-rgb), 0.1);
            transition: all 0.3s ease;
            font-size: 0.8rem;
            
            &:hover {
              background: rgba(var(--primary-rgb), 0.1);
              transform: translateY(-1px);
            }
            
            mat-icon {
              font-size: 16px;
              width: 16px;
              height: 16px;
            }
          }
        }
      }
    }

    /* Right panel (content) â€” sibling of .left-panel (not nested) */
    > .right-panel {
      flex: 1;
      height: 100%;
      background-color: var(--card-bg);
      position: relative;
      display: flex;
      flex-direction: column;
      
      .right-panel-content {
        flex: 1;
        padding: 1.5rem;
        overflow-y: auto;
        overflow-x: hidden;
      }
      
      .step-actions-footer {
        position: sticky;
        bottom: 0;
        background: var(--card-bg);
        border-top: 1px solid var(--border-color);
        padding: 1rem 1.5rem;
        backdrop-filter: blur(10px);
        z-index: 10;
      }
    }
  }

  // Step Container
  .step-container {
    padding: 32px;
    max-width: 800px;
    margin: 0 auto;
    width: 100%;
    min-height: min-content;
    opacity: 1; /* Ensure visibility */
    transform: translateX(0); /* Reset any transforms */
    transition: none; /* Let Angular animations handle transitions */
  }
  
  // Step Header
  .step-header {
    text-align: center;
    margin-bottom: 24px;
    
    h2 {
      margin: 0 0 8px 0;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 1.6rem;
    }
    
    .step-description {
      margin: 0;
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.4;
    }
  }
  
  // Form Cards Layout
  .form-cards {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  // Form Card
  .form-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 0;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    
    &:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
      border-color: var(--primary-color);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      padding: 16px 20px 12px;
      border-bottom: 1px solid var(--border-color);
      background: linear-gradient(135deg, var(--primary-light) 0%, transparent 100%);
      
      .card-icon {
        color: var(--primary-color);
        font-size: 20px;
        margin-right: 12px;
        padding: 6px;
        background: rgba(var(--primary-rgb), 0.1);
        border-radius: 6px;
      }
      
      .card-title {
        flex: 1;
        
        h3 {
          margin: 0 0 2px 0;
          color: var(--text-primary);
          font-weight: 600;
          font-size: 1.1rem;
        }
        
        p {
          margin: 0;
          color: var(--text-secondary);
          font-size: 0.85rem;
        }
      }
    }
    
    .card-content {
      padding: 20px;
    }
  }
  
  // Form Rows
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
    
    &:last-child {
      margin-bottom: 0;
    }
    
    @media (max-width: 768px) {
      grid-template-columns: 1fr;
      gap: 16px;
    }
  }
  
  /* Modern material form layout helpers */
  .form-fields {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1rem 1.25rem;
    
    @media (max-width: 768px) {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    @media (max-width: 480px) {
      gap: 0.75rem;
    }
  }
  
  // Form Fields
  .form-field, .full-width {
    width: 100%;
    margin-bottom: 1rem;
    
    ::ng-deep {
      .mat-mdc-form-field {
        width: 100%;
        
        .mat-mdc-text-field-wrapper {
          border-radius: 12px;
          background: rgba(var(--primary-rgb), 0.02);
          transition: all 0.3s ease;
          min-height: 56px;
          
          &:hover {
            background: rgba(var(--primary-rgb), 0.04);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.1);
          }
        }
        
        .mat-mdc-form-field-focus-overlay {
          border-radius: 12px;
          background: rgba(var(--primary-rgb), 0.05);
        }
        
        .mat-mdc-form-field-outline {
          .mat-mdc-notched-outline-leading,
          .mat-mdc-notched-outline-trailing,
          .mat-mdc-notched-outline-notch {
            border-color: var(--border-color);
            border-width: 1.5px;
            transition: all 0.3s ease;
          }
          
          .mat-mdc-notched-outline-leading {
            border-radius: 12px 0 0 12px;
          }
          
          .mat-mdc-notched-outline-trailing {
            border-radius: 0 12px 12px 0;
          }
        }
        
        &.mat-focused {
          .mat-mdc-form-field-outline {
            .mat-mdc-notched-outline-leading,
            .mat-mdc-notched-outline-trailing,
            .mat-mdc-notched-outline-notch {
              border-color: var(--primary-color);
              border-width: 2px;
            }
          }
        }
        
        &.mat-form-field-invalid {
          .mat-mdc-form-field-outline {
            .mat-mdc-notched-outline-leading,
            .mat-mdc-notched-outline-trailing,
            .mat-mdc-notched-outline-notch {
              border-color: var(--error-color);
              border-width: 2px;
            }
          }
          
          .mat-mdc-text-field-wrapper {
            background: rgba(var(--error-rgb), 0.03);
          }
        }
        
        .mat-mdc-form-field-subscript-wrapper {
          margin-top: 8px;
          
          .mat-mdc-form-field-error-wrapper {
            .mat-mdc-form-field-error {
              color: var(--error-color);
              font-size: 0.875rem;
              font-weight: 500;
            }
          }
        }
        
        .mat-mdc-form-field-icon-suffix {
          color: var(--text-secondary);
          transition: color 0.3s ease;
        }
        
        &.mat-focused .mat-mdc-form-field-icon-suffix {
          color: var(--primary-color);
        }
        
        .mat-mdc-input-element {
          color: var(--text-primary);
          font-size: 1rem;
          font-weight: 500;
          padding: 16px 14px;
          line-height: 1.5;
          
          &::placeholder {
            color: var(--text-secondary);
            opacity: 0.8;
            transition: opacity 0.3s ease;
          }
          
          &:focus::placeholder {
            opacity: 0.6;
          }
        }
        
        .mat-mdc-floating-label {
          color: var(--text-secondary);
          font-weight: 600;
          
          &.mdc-floating-label--float-above {
            color: var(--primary-color);
          }
        }
        
        .mat-mdc-select-trigger {
          color: var(--text-primary);
          font-weight: 500;
        }
        
        .mat-mdc-select-arrow {
          color: var(--text-secondary);
        }
        
        &.mat-focused .mat-mdc-select-arrow {
          color: var(--primary-color);
        }
      }
    }
    
    &.full-width-field {
      grid-column: 1 / -1;
    }
    
    // Mobile-specific improvements
    @media (max-width: 768px) {
      margin-bottom: 1.25rem;
      
      ::ng-deep .mat-mdc-form-field {
        .mat-mdc-text-field-wrapper {
          min-height: 60px;
        }
        
        .mat-mdc-input-element {
          padding: 18px 16px;
          font-size: 1.1rem;
        }
        
        .mat-mdc-floating-label {
          font-size: 1rem;
        }
      }
    }
    
    @media (max-width: 480px) {
      ::ng-deep .mat-mdc-form-field {
        .mat-mdc-text-field-wrapper {
          min-height: 64px;
        }
        
        .mat-mdc-input-element {
          padding: 20px 16px;
          font-size: 1.125rem;
        }
      }
    }
  }

  .full-width { width: 100%; }

  // Dropdown panel styling
  ::ng-deep .mat-mdc-select-panel {
    background: var(--card-bg) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 12px !important;
    box-shadow: var(--shadow-lg) !important;
    max-height: 300px !important;
    overflow-y: auto !important;
    z-index: 10001 !important;
    position: fixed !important;
    min-width: 200px !important;
    transform-origin: top !important;
    animation: dropdownSlideIn 0.2s ease-out !important;
    
    .mat-mdc-option {
      color: var(--text-primary) !important;
      font-weight: 500 !important;
      padding: 12px 16px !important;
      transition: all 0.2s ease !important;
      min-height: 48px !important;
      display: flex !important;
      align-items: center !important;
      cursor: pointer !important;
      
      &:hover {
        background: rgba(var(--primary-rgb), 0.08) !important;
        color: var(--primary-color) !important;
      }
      
      &.mat-mdc-option-active {
        background: rgba(var(--primary-rgb), 0.12) !important;
        color: var(--primary-color) !important;
      }
      
      &.mdc-list-item--selected {
        background: rgba(var(--primary-rgb), 0.15) !important;
        color: var(--primary-color) !important;
        font-weight: 600 !important;
      }
      
      &.mat-mdc-option-disabled {
        color: var(--text-secondary) !important;
        opacity: 0.6 !important;
        cursor: not-allowed !important;
      }
    }
  }
  
  // Dropdown animation
  @keyframes dropdownSlideIn {
    from {
      opacity: 0;
      transform: translateY(-10px) scaleY(0.9);
    }
    to {
      opacity: 1;
      transform: translateY(0) scaleY(1);
    }
  }
  
  // Autocomplete panel styling
  ::ng-deep .mat-mdc-autocomplete-panel {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    max-height: 300px;
    
    .mat-mdc-option {
      color: var(--text-primary);
      font-weight: 500;
      padding: 12px 16px;
      transition: all 0.2s ease;
      
      &:hover {
        background: rgba(var(--primary-rgb), 0.08);
        color: var(--primary-color);
      }
      
      &.mat-mdc-option-active {
        background: rgba(var(--primary-rgb), 0.12);
        color: var(--primary-color);
      }
    }
  }

  .step-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    
    // When only continue button is present (step 1)
    &.single-button {
      justify-content: flex-end;
    }
    
    .back-button {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      background: transparent;
      border: 1px solid var(--border-color);
      padding: 12px 20px;
      border-radius: 12px;
      transition: all 0.3s ease;
      
      &:hover {
        color: var(--text-primary);
        background: rgba(var(--primary-rgb), 0.05);
        border-color: rgba(var(--primary-rgb), 0.2);
      }
    }
    
    .continue-button {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 140px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 12px;
      transition: all 0.3s ease;
      margin-left: auto;
      
      &:hover:not([disabled]) {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(var(--primary-rgb), 0.3);
      }
      
      &[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
    }
  }

  .step-actions button:first-child { margin-right: auto; }

  // Responsive styles
  @media (max-width: 992px) {
    .onboarding-container {
      padding: 1rem;
    }
    
    .onboarding-card {
      max-width: 100%;
      margin: 0;
      border-radius: 16px;
    }
    
    .onboarding-panels {
      flex-direction: column;
      
      .left-panel {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem 1rem;
        background: linear-gradient(to right, rgba(var(--primary-rgb), 0.05), rgba(var(--primary-rgb), 0.1));
        
        .dark-theme & {
          background: linear-gradient(to right, rgba(var(--primary-rgb), 0.1), rgba(var(--primary-rgb), 0.15));
        }
        
        .stepper-nav { /* unchanged */ }
      }

      /* Mobile spacing for right panel */
      > .right-panel { padding: 1.25rem 1rem 6.5rem; }
    }

    .form-fields { grid-template-columns: 1fr; }
  }
  
  @media (max-width: 768px) {
    height: 100vh;
    width: 100vw;
    
    .steps-preview {
      .step-preview-item {
        padding: 0.75rem;
      }
    }
  }
}

// Animation classes
.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

.slide-in-right {
  animation: slideInRight 0.5s ease-in-out;
}

.slide-in-left {
  animation: slideInLeft 0.5s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideInRight {
  from { transform: translateX(50px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideInLeft {
  from { transform: translateX(-50px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.onboarding-stepper-container {
  /* Define component-scoped CSS variables to ensure availability */
  --primary-color: #4f46e5;
  --primary-dark: #4338ca;
  --primary-rgb: 79, 70, 229;
  --primary-light: rgba(79, 70, 229, 0.1);
  --primary-hover: rgba(79, 70, 229, 0.15);
  --success-color: #10b981;
  --success-rgb: 16, 185, 129;
  --error-color: #ef4444;
  --error-rgb: 239, 68, 68;
  --text-primary: #111827;
  --text-secondary: #6b7280;
  --border-color: rgba(0, 0, 0, 0.08);
  --card-bg: #ffffff;
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 12px 35px rgba(0, 0, 0, 0.15);
  --border-radius: 20px;
  --transition-speed: 0.3s;
}

.dark-theme .onboarding-stepper-container {
  --primary-color: #818cf8;
  --primary-dark: #6366f1;
  --primary-rgb: 129, 140, 248;
  --primary-light: rgba(129, 140, 248, 0.15);
  --primary-hover: rgba(129, 140, 248, 0.25);
  --success-color: #34d399;
  --success-rgb: 52, 211, 153;
  --error-color: #f87171;
  --error-rgb: 248, 113, 113;
  --text-primary: #f9fafb;
  --text-secondary: #d1d5db;
  --border-color: rgba(255, 255, 255, 0.1);
  --card-bg: #1f2937;
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.25);
  --shadow-lg: 0 12px 35px rgba(0, 0, 0, 0.3);
}